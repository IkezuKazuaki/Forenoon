# Forenoon アプリケーション仕様書

## 1. 概要

Forenoonは、ユーザーの日常生活をサポートするための多機能Webアプリケーションです。タスク管理、日記記録、睡眠スケジュール管理、AIアシスタントとの対話、縦書きSNS機能などを統合し、ユーザーの生産性向上と健康的な生活習慣の確立を支援します。

## 2. システム構成

### 2.1 技術スタック

#### バックエンド
- 言語: Python
- フレームワーク: Django, Django REST Framework
- データベース: SQLite（開発環境）
- 外部API: Google Gemini API（AI対話機能）

#### フロントエンド
- 言語: JavaScript
- フレームワーク: React.js
- UIライブラリ: Bootstrap, React Bootstrap
- その他ライブラリ: Axios, React Router, React Icons, React Calendar, React Datepicker

### 2.2 システムアーキテクチャ

- RESTful APIアーキテクチャ
- JWT（JSON Web Token）による認証
- フロントエンドとバックエンドの分離アーキテクチャ

## 3. 機能仕様

### 3.1 認証・ユーザー管理

#### 3.1.1 ユーザー登録
- ユーザー名とパスワードによる新規アカウント作成
- ユーザー名の重複チェック
- パスワードのバリデーション

#### 3.1.2 ログイン/ログアウト
- JWT認証によるセキュアなログイン
- トークンの自動更新
- ログアウト機能

#### 3.1.3 プロフィール管理
- プロフィール画像のアップロードと表示
- 画像の自動リサイズと正方形クロップ処理（200x200ピクセル）

### 3.2 タスク管理機能

#### 3.2.1 タスクの種類
- デイリータスク: 毎日繰り返し行うタスク
- 今日のタスク: 特定の日に行うタスク
- 今後のタスク: 将来の日付に予定されたタスク

#### 3.2.2 タスク操作
- タスクの作成: 名前、種類、日付（必要に応じて）の設定
- タスクの編集: 名前の変更
- タスクの削除
- タスクの完了状態の管理

### 3.3 日記機能

#### 3.3.1 日記の作成と管理
- 日付指定による日記の作成
- テキスト形式での日記内容の記録
- 日記の編集と更新
- 日記とタスクの関連付け

#### 3.3.2 日記の表示
- タイムライン形式での日記一覧表示
- 日付順（新しい順）でのソート
- ダークモード切り替え機能

### 3.4 睡眠管理機能（SleepMaster）

#### 3.4.1 睡眠スケジュール管理
- 目標起床時間と就寝時間の設定
- スケジュールの保存と更新
- 最新スケジュールの自動読み込み

#### 3.4.2 AIアシスタント対話
- キャラクター選択機能
- ユーザーとAIアシスタント間のチャットインターフェース
- Google Gemini APIを活用した自然言語対話
- 睡眠スケジュールに基づいたパーソナライズされた応答

#### 3.4.3 キャラクター管理
- 複数キャラクターの管理
- キャラクターアイコンの表示
- キャラクター情報（名前、説明）の管理

### 3.5 縦書きSNS機能（Tategram）

#### 3.5.1 投稿機能
- 縦書きテキスト投稿の作成
- 複数行テキストの対応
- 投稿の表示（右から左への縦書きレイアウト）

## 4. データモデル

### 4.1 ユーザーモデル
- User: カスタムユーザーモデル（Django AbstractUserを拡張）
  - username: ユーザー名
  - password: パスワード（ハッシュ化）
  - profile_image: プロフィール画像

### 4.2 タスク関連モデル
- Task: タスク情報
  - user: タスク所有者（外部キー）
  - name: タスク名
  - date: タスク日付（null可）
  - is_daily: デイリータスクフラグ
  - created_at: 作成日時
  - updated_at: 更新日時

### 4.3 日記関連モデル
- Diary: 日記情報
  - user: 日記所有者（外部キー）
  - date: 日記日付
  - content: 日記内容
  - created_at: 作成日時
  - updated_at: 更新日時

- DiaryTask: 日記とタスクの関連付け
  - user: 所有者（外部キー）
  - diary: 日記（外部キー）
  - task: タスク（外部キー）
  - is_completed: 完了状態

### 4.4 睡眠管理関連モデル
- SleepSchedule: 睡眠スケジュール
  - user: スケジュール所有者（外部キー）
  - wake_up_time: 目標起床時間
  - sleep_time: 目標就寝時間
  - date: 記録日付

- Character: AIアシスタントキャラクター
  - name: キャラクター名
  - description: キャラクター説明
  - icon: キャラクターアイコン画像

## 5. API仕様

### 5.1 認証API
- POST /api/register/: ユーザー登録
- POST /api/token/: JWTトークン取得
- POST /api/token/refresh/: JWTトークン更新

### 5.2 ユーザープロフィールAPI
- GET /user-profile/: ユーザープロフィール取得
- POST /upload-profile-image/: プロフィール画像アップロード

### 5.3 タスク管理API
- GET /tasks/: タスク一覧取得
- POST /tasks/: タスク作成
- GET /tasks/{id}/: 特定タスク取得
- PUT /tasks/{id}/: タスク更新
- DELETE /tasks/{id}/: タスク削除
- GET /today-tasks/: 今日のタスク取得
- GET /future-tasks/: 今後のタスク取得
- GET /daily-tasks/: デイリータスク取得

### 5.4 日記API
- GET /diaries/: 日記一覧取得
- POST /diaries/: 日記作成
- GET /diaries/{id}/: 特定日記取得
- PUT /diaries/{id}/: 日記更新
- DELETE /diaries/{id}/: 日記削除

### 5.5 睡眠管理API
- GET /api/sleep-master/schedules/: スケジュール一覧取得
- POST /api/sleep-master/schedules/: スケジュール作成
- GET /api/sleep-master/schedules/{id}/: 特定スケジュール取得
- PUT /api/sleep-master/schedules/{id}/: スケジュール更新
- DELETE /api/sleep-master/schedules/{id}/: スケジュール削除
- GET /api/sleep-master/schedules/latest/: 最新スケジュール取得
- POST /api/sleep-master/gemini/message/: Gemini APIメッセージ送信
- GET /api/sleep-master/characters/: キャラクター一覧取得

## 6. UI仕様

### 6.1 共通UI要素
- レスポンシブデザイン（モバイル対応）
- ナビゲーションバー（ログイン時のみ表示）
- ダークモード対応（一部機能）

### 6.2 ページ構成
- ランディングページ: 未ログインユーザー向けの紹介ページ
- ログイン/登録ページ: ユーザー認証フォーム
- ダッシュボード: ユーザーの概要情報表示
- 日記ページ: 日記作成フォームとタイムライン表示
- SleepMasterページ: 睡眠スケジュール管理とAIチャット
- Tategramページ: 縦書きSNS投稿と表示
- プロフィールページ: ユーザー情報管理

## 7. セキュリティ仕様

### 7.1 認証セキュリティ
- パスワードのハッシュ化保存
- JWTによるステートレス認証
- トークン有効期限の設定

### 7.2 アクセス制御
- 認証済みユーザーのみがAPIにアクセス可能
- ユーザー固有のデータへのアクセス制限
- CSRF保護

## 8. 外部連携

### 8.1 Google Gemini API連携
- APIキーによる認証
- プロンプト生成による対話コンテキスト管理
- エラーハンドリングとリトライ機能

## 9. 将来の拡張性

### 9.1 潜在的な機能拡張
- 健康管理機能の強化
- ソーシャル機能の拡充
- モバイルアプリ対応
- データ分析・可視化機能
- 多言語対応

## 10. 開発・運用環境

### 10.1 開発環境
- ローカル開発サーバー
  - バックエンド: Django開発サーバー（ポート8000）
  - フロントエンド: React開発サーバー（ポート3000）
- 開発用データベース: SQLite

### 10.2 デプロイ環境
- 本番環境構成は未定義
- 環境変数による設定分離
  - API_BASE_URL
  - GEMINI_API_KEY
